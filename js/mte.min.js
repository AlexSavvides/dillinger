/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.1.9
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var MTE=function(e,t){function n(e,t){e=e||{};for(var l in t)e[l]="object"==typeof t[l]?n(e[l],t[l]):t[l];return e}function l(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),l=0;return l=f.defaultView&&f.defaultView.getComputedStyle?f.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function i(e,t){return d.insert(e,function(){d.select(t.end+1)}),!1}function r(e){return e.replace(/^\s+|\s+$/g,"")}function o(e){return e.replace(/^\s+/,"")}function a(e){return e.replace(/\s+$/,"")}function c(e){return e.replace(d.escape,"\\$1")}void 0!==t.prompt&&(t.prompts=t.prompt),void 0!==t.placeholder&&(t.placeholders=t.placeholder);var u=this,s=window,f=document,d=new Editor(e),p={tabSize:"    ",toolbar:!0,shortcut:!1,toolbarClass:"editor-toolbar",toolbarPosition:"before",buttonClassPrefix:"editor-toolbar-button editor-toolbar-button-",iconClassPrefix:"fa fa-",STRONG:"**",EM:"_",UL:"- ",OL:"%d. ",HR:"---",CODE:"`",PRE:"    ",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",code:"Code",quote:"Quote",heading:"H1 \u2013 H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here\u2026",link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here\u2026",heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){}},g=f.createElement("div"),h=f.createElement("div"),m=n(p,t),v=f.createElement("span"),b=c(m.UL).replace(/\\[-+*]/g,"[-+*]"),y=c(m.OL).replace(/%d/g,"[0-9]+"),k=c(m.tabSize),x=c(m.PRE);u.modal=function(e,t){e=e||"modal";var n=f.body,l=n.scrollTop||f.documentElement.scrollTop;g.className="custom-modal-overlay custom-modal-"+e+"-overlay",g.onclick=function(){u.close(!0)},h.className="custom-modal custom-modal-"+e,h.innerHTML='<div class="custom-modal-header custom-modal-'+e+'-header"></div><div class="custom-modal-content custom-modal-'+e+'-content"></div><div class="custom-modal-action custom-modal-'+e+'-action"></div>',h.style.visibility="hidden",n.appendChild(g),n.appendChild(h),s.setTimeout(function(){var e=h.offsetWidth,t=h.offsetHeight;h.style.position="absolute",h.style.top="50%",h.style.left="50%",h.style.zIndex="9999",h.style.marginTop=l-t/2+"px",h.style.marginLeft=0-e/2+"px",h.style.visibility="",h.offsetTop<0&&(h.style.top=0,h.style.marginTop=0),h.offsetLeft<0&&(h.style.left=0,h.style.marginLeft=0)},10),"function"==typeof t&&t(g,h)},u.close=function(e){if(g&&f.body.removeChild(g),h&&f.body.removeChild(h),e&&e!==!1){var t=d.selection();d.select(t.start,t.end)}},u.prompt=function(e,t,n,l){u.modal("prompt",function(i,r){var o=function(e){"function"==typeof l?(u.close(),l(e)):u.close(!0)},a=f.createElement("input");a.type="text",a.value=t,a.onkeyup=function(e){n?13==e.keyCode&&""!==this.value&&this.value!==t&&o(this.value):13==e.keyCode&&o(this.value==t?"":this.value)};var c=f.createElement("button");c.innerHTML=m.buttons.ok,c.onclick=function(){n?""!==a.value&&a.value!==t&&o(a.value):o(a.value==t?"":a.value)};var d=f.createElement("button");d.innerHTML=m.buttons.cancel,d.onclick=function(){u.close(!0)},r.children[0].innerHTML=e?e:"",r.children[1].appendChild(a),r.children[2].appendChild(c),r.children[2].appendChild(f.createTextNode(" ")),r.children[2].appendChild(d),s.setTimeout(function(){a.select()},10)})},u.alert=function(e,t,n){u.modal("alert",function(l,i){var r=f.createElement("button");r.innerHTML=m.buttons.ok,r.onclick=function(){"function"==typeof n?(u.close(),n()):u.close(!0)},i.children[0].innerHTML=e?e:"",i.children[1].innerHTML=t?t:"",i.children[2].appendChild(r)})},u.confirm=function(e,t,n){u.modal("confirm",function(l,i){var r=f.createElement("button");r.innerHTML=m.buttons.ok,r.onclick=function(){void 0===n?u.close(!0):"function"==typeof n.OK?(u.close(),n.OK()):u.close(!0)};var o=f.createElement("button");o.innerHTML=m.buttons.cancel,o.onclick=function(){return void 0===n?u.close(!0):"function"==typeof n.CANCEL?(u.close(),n.CANCEL()):u.close(!0),!1},i.children[0].innerHTML=e?e:"",i.children[1].innerHTML=t?t:"",i.children[2].appendChild(r),i.children[2].appendChild(f.createTextNode(" ")),i.children[2].appendChild(o)})},u.scroll=function(e,t){var n=d.area;"number"==typeof e?n.scrollTop=e:n.scrollTop+=parseInt(l(n,"line-height"),10),"function"==typeof t&&t()},u.time=function(e){var t=new Date,n=t.getFullYear(),l=t.getMonth()+1,i=t.getDate(),r=t.getHours(),o=t.getMinutes(),a=t.getSeconds(),c=t.getMilliseconds();10>l&&(l="0"+l),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>a&&(a="0"+a),10>c&&(c="0"+c);var u={Y:""+n,m:""+l,d:""+i,H:""+r,i:""+o,s:""+a,u:""+c};return void 0!==e?u[e]:u},m.toolbar&&(v.className=m.toolbarClass,d.area.parentNode.insertBefore(v,"before"==m.toolbarPosition?d.area:null));var E=f.createElement("a");E.href="#esc:"+(new Date).getTime(),E.style.width=0,E.style.height=0,d.area.parentNode.appendChild(E),u.button=function(e,t){if(t.title!==!1){var n=f.createElement("a");if(n.className=m.buttonClassPrefix+e,n.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),n.setAttribute("tabindex",-1),n.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+m.iconClassPrefix+e+'"></i>',n.onclick=function(e){return t.click(e,u),m.click(e,u,this.hash.replace("#","")),!1},t.title&&(n.title=t.title),t.position){var l=t.position<0?t.position+v.children.length+1:t.position-1;v.insertBefore(n,v.children[l])}else v.appendChild(n)}},d.toggle=function(e,t,n,l){var i=d.selection();if(i.before.slice(-e.length)!=e&&i.after.slice(0,t.length)!=t)d.wrap(e,t,0===i.value.length&&l?function(){d.replace(/^.*$/,l===!0?m.placeholders.text:l)}:1);else{var r=i.before.slice(-e.length)==e?i.before.substring(0,i.before.length-e.length):i.before,o=i.after.substring(0,t.length)==t?i.after.substring(t.length):i.after;d.area.value=r+i.value+o,d.select(r.length,r.length+i.value.length,function(){d.updateHistory()})}"function"==typeof n&&n()};var H=0,_=m.buttons,C={bold:{title:_.bold,click:function(){var e=m.STRONG;d.toggle(e,e,1,!0)}},italic:{title:_.italic,click:function(){var e=m.EM;d.toggle(e,e,1,!0)}},code:{title:_.code,click:function(){var e=d.selection().value,t=m.CODE,n=m.PRE;if(-1!==e.indexOf("\n")&&e.length>0)if(-1===n.indexOf("%s")){var l="("+x+"|\\t| {4})";e.match(RegExp("^"+l))?d.outdent(n):d.indent(n)}else{var i=n.split("%s");d.toggle(i[0],i[1]||i[0])}else d.toggle(t,t,1,!0)}},"quote-right":{title:_.quote,click:function(){var e,t=d.selection(),n=a(t.before),l=r(t.value),i=o(t.after),c=n.length>0?"\n\n":"",u=l;0===l.length&&(l=m.placeholders.text),u==m.placeholders.text?d.select(t.start,t.end):u.length>0?d[">"==u[0]?"outdent":"indent"]("> "):(d.area.value=n+c+"> "+l+"\n\n"+i,e=n.length+c.length+2,d.select(e,e+l.length,function(){d.updateHistory()}))}},header:{title:_.heading,click:function(){var e,t=d.selection(),n=["","=","-","### ","#### ","##### ","###### "],l=a(t.before.replace(/#+ $/,"")),i=r(t.value.replace(/#+ |\n+[-=]+/,"").replace(/\n+/g," ")),c=o(t.after.replace(/^\n+[-=]+/,"")),u=l.length>0?"\n\n":"";if(H=H<n.length-1?H+1:0,t.value.length>0)H>0&&3>H?(d.area.value=l+u+i+"\n"+i.replace(/./g,n[H])+"\n\n"+c,e=l.length+u.length,d.select(e,e+i.length,function(){d.updateHistory()})):(d.area.value=l+u+n[H]+i+"\n\n"+c,e=l.length+u.length+n[H].length,d.select(e,e+i.length,function(){d.updateHistory()}));else{var s=m.placeholders.heading_text;H=1,d.area.value=l+u+s+"\n"+s.replace(/./g,n[H])+"\n\n"+c,e=l.length+u.length,d.select(e,e+s.length,function(){d.updateHistory()})}}},link:{title:_.link,click:function(){var e,t,n=d.selection(),l=m.placeholders.link_text;u.prompt(m.prompts.link_url_title,m.prompts.link_url,!0,function(i){t=i,u.prompt(m.prompts.link_title_title,m.prompts.link_title,!1,function(i){e=i,d.wrap("[","]("+t+(""!==e?' "'+e+'"':"")+")",0===n.value.length?function(){d.replace(/^/,l)}:1)})})}},image:{title:_.image,click:function(){u.prompt(m.prompts.image_url_title,m.prompts.image_url,!0,function(e){var t=d.selection(),n=a(t.before),l=o(t.after),i=n.length>0?"\n\n":"",r=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});r=-1===r.indexOf("/")&&-1!==e.indexOf(".")?r:m.placeholders.image_alt,d.area.value=n+i+"!["+r+"]("+e+")\n\n"+l,d.select(n.length+i.length+2+r.length+2+e.length+3,function(){d.updateHistory()})})}},"list-ol":{title:_.ol,click:function(){var e=d.selection(),t=0;if(e.value==m.placeholders.list_ol_text)d.select(e.start,e.end);else if(e.value.length>0)d.indent("",function(){d.replace(/^[^\n]/gm,function(e){return t++,e.replace(/^/," "+m.OL.replace(/%d/g,t))})});else{var n=" "+m.OL.replace(/%d/g,1),l=n+m.placeholders.list_ol_text;d.insert(l,function(){d.select(e.start+n.length,e.start+l.length,function(){d.updateHistory()})})}}},"list-ul":{title:_.ul,click:function(){var e=d.selection();if(e.value==m.placeholders.list_ul_text)d.select(e.start,e.end);else{var t=" "+m.UL;if(e.value.length>0)d.indent(t);else{var n=t+m.placeholders.list_ul_text;d.insert(n,function(){d.select(e.start+t.length,e.start+n.length,function(){d.updateHistory()})})}}}},"ellipsis-h":{title:_.rule,click:function(){var e=d.selection(),t=a(e.before),n=o(e.after),l=t.length>0?"\n\n":"";d.area.value=t+l+m.HR+"\n\n"+n,d.select(t.length+l.length+m.HR.length+2,function(){d.updateHistory()})}},undo:{title:_.undo,click:function(){d.undo()}},repeat:{title:_.redo,click:function(){d.redo()}}};for(var L in C)u.button(L,C[L]);d.area.oncut=function(){s.setTimeout(function(){d.updateHistory()},1)},d.area.onpaste=function(){s.setTimeout(function(){d.updateHistory()},1)},d.area.onkeydown=function(e){var t=this,n=d.selection(),l=e.keyCode,r=e.ctrlKey,o=e.shiftKey,c=e.altKey;s.setTimeout(function(){m.keydown(e,u)},10);var f=n.before,p=n.after[0],g="\\"==f.slice(-1);if(-1!==f.indexOf("(")&&o&&48==l&&")"==p&&!g||-1!==f.indexOf("{")&&o&&221==l&&"}"==p&&!g||-1!==f.indexOf("[")&&221==l&&"]"==p&&!g||-1!==f.indexOf('"')&&o&&222==l&&'"'==p&&!g||-1!==f.indexOf("'")&&!o&&222==l&&"'"==p&&!g||-1!==f.indexOf("`")&&!o&&192==l&&"`"==p&&!g||-1!==f.indexOf("<")&&o&&190==l&&">"==p&&!g)return d.select(n.end+1),!1;if(o&&57==l&&!g)return i("("+n.value+")",n);if(o&&219==l&&!g)return i("{"+n.value+"}",n);if(!o&&219==l&&!g)return i("["+n.value+"]",n);if(o&&222==l&&!g)return i('"'+n.value+'"',n);if(!o&&222==l&&!g)return i("'"+n.value+"'",n);if(!o&&192==l&&!g)return i("`"+n.value+"`",n);if(o&&188==l&&!g)return i("<"+n.value+">",n);if(o&&9==l)return d.outdent("( *"+y+"| *"+b+"|> *|"+k+")",1,!0),!1;if(9==l){if(n.before.match(/<[^\/>]*?$/)&&">"==n.after[0]){var h=/<([^\/>]*?)$/.exec(n.before);return t.value=n.before+" "+n.value+"></"+h[1].split(" ")[0]+n.after,d.select(n.start+1,function(){d.updateHistory()}),!1}return d.indent(m.tabSize),!1}if(r&&90==l)return d.undo(),!1;if(r&&89==l||r&&82==l)return d.redo(),!1;if(m.shortcut){if(r&&66==l)return C.bold.click(),!1;if(r&&73==l)return C.italic.click(),!1;if(r&&81==l)return C["quote-right"].click(),!1;if(o&&81==l&&n.value.length>0)return c?d.toggle("\u2018","\u2019"):d.toggle("\u201C","\u201D"),!1;if(r&&72==l)return C.header.click(),!1;if(r&&76==l)return C.link.click(),!1;if(r&&71==l)return C.image.click(),!1}if(32==l){var h="(^|\\n)("+a(y)+"|"+a(b)+")";if(n.before.match(RegExp(h+"$")))return t.value=n.before.replace(RegExp(h+"$"),"$1 $2 ")+n.value+n.after,d.select(n.end+2,function(){d.updateHistory()}),!1}if(13==l){var v=RegExp("(?:^|\\n)( *)("+y+"|"+b+"|>)( *)(.*?)$");if(n.before.match(v)){var x=v.exec(n.before),H=RegExp(y).test(x[2])?m.OL.replace(/%d/g,parseInt(x[2],10)+1):x[2];return d.insert("\n"+x[1]+H+x[3],1),u.scroll(),!1}var _=RegExp("(?:^|\\n)(("+k+")+)(.*?)$").exec(n.before),L=_?_[1]:"";return n.before.match(/[\(\{\[]$/)&&n.after.match(/^[\]\}\)]/)||n.before.match(/<[^\/]*?>$/)&&n.after.match(/^<\//)?(d.insert("\n"+L+k+"\n"+L,function(){d.select(n.start+L.length+m.tabSize.length+1,function(){d.updateHistory()})}),u.scroll(),!1):(d.insert("\n"+L),u.scroll(),!1)}if(8==l&&0===n.value.length){var h=" *("+y+"|"+b+"|> )";if(n.before.match(RegExp(h+"$")))return d.outdent(h,1,!0),!1;if(n.before.match(RegExp(k+"$")))return d.outdent(m.tabSize),!1;if(n.before.match(/<\/?[^>]*?>$/))return d.outdent("</?[^>]*?>",1,!0),!1;switch(n.before.slice(-1)){case"(":return d.toggle("(",")"),!1;case"{":return d.toggle("{","}"),!1;case"[":return d.toggle("[","]"),!1;case'"':return d.toggle('"','"'),!1;case"'":return d.toggle("'","'"),!1;case"<":return d.toggle("<",">"),!1;case"*":return d.toggle("*","*"),!1;case"_":return d.toggle("_","_"),!1;case"~":return d.toggle("~","~"),!1;case"`":return d.toggle("`","`"),!1}}return 27==l?(E.focus(),!1):void(c||r||o||s.setTimeout(function(){d.updateHistory()},1))},m.ready(u),u.grip=d,u.grip.config=m};