/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.0.0
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 *     REQUIRES:
 *     ======================================================
 *     1. https://github.com/tovic/simple-text-editor-library
 *     2. http://fortawesome.github.io/Font-Awesome/icons
 *     ======================================================
 *
 */

;var MTE=function(e,d){var c=this,k=window,q=document,l=new Editor(e),g={tabSize:"    ",toolbar:true,toolbarClass:"editor-toolbar",toolbarPosition:"before",appendModalTo:document.body,iconClassPrefix:"fa fa-",buttons:{OK:"OK",YES:"Yes",NO:"No",CANCEL:"Cancel"},prompt:{linkTitle:"Your link title goes here...",linkTitle_title:"Link title:",linkURL:"http://",linkURL_title:"Link URL:",imageURL:"http://",imageURL_title:"Image URL:"},placeholder:{headingText:"Your Heading Text Goes Here",linkText:"Your link text goes here...",imageAlt:"Image",listUL:"List Item",listOL:"List Item"},keydown:function(){},ready:function(){}};g.toolbars={bold:{title:"Bold",click:function(){l.toggle("**","**")}},italic:{title:"Italic",click:function(){l.toggle("_","_")}},code:{title:"Code",click:function(){var a=l.selection().value;if(a.indexOf("\n")!==-1&&a.length>0){l.indent(g.tabSize)}else{l.toggle("`","`")}}},"quote-right":{title:"Quote",click:function(){l.indent("> ")}},"sort-amount-desc":{title:"H1 \u2013 H6",click:function(){l.heading()}},link:{title:"Link",click:function(){var i=l.selection(),t,a,o=g.placeholder.linkText;c.prompt(g.prompt.linkTitle_title,g.prompt.linkTitle,false,function(s){t=s;c.prompt(g.prompt.linkURL_title,g.prompt.linkURL,true,function(u){a=u;l.wrap("["+(i.value.length===0?o:""),"]("+a+(t!==""?' "'+t+'"':"")+")",function(){l.select(i.start+1,(i.value.length===0?i.start+o.length+1:i.end+1),function(){l.updateHistory()})})})})}},"picture-o":{title:"Image",click:function(){c.prompt(g.prompt.imageURL_title,g.prompt.imageURL,true,function(a){var i=decodeURIComponent(a.substring(a.lastIndexOf("/")+1,a.lastIndexOf(".")).replace(/[\-\_\+]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(o){return o.toUpperCase()});i=i.indexOf("/")<0?i:g.placeholder.imageAlt;l.insert("\n!["+i+"]("+a+")\n",function(){l.updateHistory()})})}},"list-ol":{title:"Ordered List",click:function(){var o=l.selection(),a=0,i="";if(o.value.length>0){l.indent("",function(){l.replace(/^[^\n\r]/gm,function(s){a++;i+=" "+a+". ";return s.replace(/^/," "+a+". ")})})}else{var t=" 1. "+g.placeholder.listOL;l.insert(t,function(){l.select(o.start+4,o.start+t.length)})}}},"list-ul":{title:"Unordered List",click:function(){var a=l.selection();if(a.value.length>0){l.indent(" * ")}else{var i=" * "+g.placeholder.listUL;l.insert(i,function(){l.select(a.start+3,a.start+i.length)})}}},"ellipsis-h":{title:"Horizontal Rule",click:function(){l.insert("\n---\n")}},"rotate-left":{title:"Undo",click:function(){l.undo()}},"rotate-right":{title:"Redo",click:function(){l.redo()}}};function m(i,a){i=i||{};for(var o in a){if(typeof a[o]==="object"){i[o]=m(i[o],a[o])}else{i[o]=a[o]}}return i}g=m(g,d);c.prompt=function(w,x,i,z){var u=g.appendModalTo,o=q.createElement("div");o.className="custom-modal-overlay custom-prompt-overlay";var y=q.createElement("div");y.className="custom-modal custom-prompt";y.innerHTML='<div class="custom-modal-header custom-prompt-header">'+(w?w:"")+'</div><div class="custom-modal-content custom-prompt-content"></div><div class="custom-modal-action custom-prompt-action"></div>';var t=function(A){o.parentNode.removeChild(o);y.parentNode.removeChild(y);if(typeof z=="function"){z(A)}};var v=q.createElement("input");v.type="text";v.value=x;v.onkeyup=function(A){if(i){if(A.keyCode==13&&this.value!==""&&this.value!==x){t(this.value)}}else{if(A.keyCode==13){t(this.value==x?"":this.value)}}};var a=q.createElement("button");a.innerHTML=g.buttons.OK;a.onclick=function(){if(i){if(v.value!==""&&v.value!==x){t(v.value)}}else{t(v.value==x?"":v.value)}};var s=q.createElement("button");s.innerHTML=g.buttons.CANCEL;s.onclick=function(){o.parentNode.removeChild(o);y.parentNode.removeChild(y)};u.appendChild(o);u.appendChild(y);y.children[1].appendChild(v);y.children[2].appendChild(a);y.children[2].appendChild(q.createTextNode(" "));y.children[2].appendChild(s);v.select()};c.alert=function(u,s,v){var t=g.appendModalTo,a=q.createElement("div");a.className="custom-modal-overlay custom-alert-overlay";var o=q.createElement("div");o.className="custom-modal custom-alert";o.innerHTML='<div class="custom-modal-header custom-alert-header">'+(u?u:"")+'</div><div class="custom-modal-content custom-alert-content">'+(s?s:"")+'</div><div class="custom-modal-action custom-alert-action"></div>';var i=q.createElement("button");i.innerHTML=g.buttons.OK;i.onclick=function(){a.parentNode.removeChild(a);o.parentNode.removeChild(o);if(typeof v=="function"){v()}};t.appendChild(a);t.appendChild(o);o.children[2].appendChild(i)};c.confirm=function(v,t,w){var u=g.appendModalTo,i=q.createElement("div");i.className="custom-modal-overlay custom-confirm-overlay";var s=q.createElement("div");s.className="custom-modal custom-confirm";s.innerHTML='<div class="custom-modal-header custom-confirm-header">'+(v?v:"")+'</div><div class="custom-modal-content custom-confirm-content">'+(t?t:"")+'</div><div class="custom-modal-action custom-confirm-action"></div>';var o=q.createElement("button");o.innerHTML=g.buttons.OK;o.onclick=function(){i.parentNode.removeChild(i);s.parentNode.removeChild(s);if(typeof w.OK=="function"){w.OK()}};var a=q.createElement("button");a.innerHTML=g.buttons.CANCEL;a.onclick=function(){i.parentNode.removeChild(i);s.parentNode.removeChild(s);if(typeof w.CANCEL=="function"){w.CANCEL()}return false};u.appendChild(i);u.appendChild(s);s.children[2].appendChild(o);s.children[2].appendChild(q.createTextNode(" "));s.children[2].appendChild(a)};l.toggle=function(o,u,v){var t=l.selection();if(t.before.slice(-o.length)!=o&&t.after.slice(0,u.length)!=u){l.wrap(o,u)}else{var a=t.before.substring(0,t.before.length-o.length),i=t.after.substring(u.length);l.area.value=a+t.value+i;l.select(a.length,a.length+t.value.length,function(){l.updateHistory()})}if(typeof v=="function"){v()}};var f=0;l.heading=function(){var t=l.selection(),o=["","# ","## ","### ","#### ","##### ","###### "];f=f<o.length-1?f+1:0;if(t.value.length>0){if(!t.before.match(/\#+ $/)){l.wrap(o[f],"",function(){l.replace(/^\#+ /,"")})}else{var a=t.before.replace(/\#+ $/,""),i=t.value.replace(/^\#+ /,"");l.area.value=a+o[f]+i+t.after;l.select(a.length+o[f].length,a.length+o[f].length+i.length,function(){l.updateHistory()})}}else{var u=g.placeholder.headingText;f=1;l.insert(o[f]+u,function(){t=l.selection().end;l.select(t-u.length-o[f].length+2,t,function(){l.updateHistory()})})}};var b=q.createElement("nav");b.className=g.toolbarClass;for(var j in g.toolbars){var p=q.createElement("a");p.href="#"+j;p.innerHTML='<i class="'+g.iconClassPrefix+j+'"></i>';p.onclick=function(){g.toolbars[this.hash.replace("#","")].click();return false};if(g.toolbars[j].title){p.title=g.toolbars[j].title}if(g.toolbars[j].position){var n=g.toolbars[j].position-1;b.insertBefore(p,b.children[n])}else{b.appendChild(p)}if(g.toolbar){l.area.parentNode.insertBefore(b,g.toolbarPosition=="before"?l.area:null)}}var h=0,r=function(i,a){l.insert(i,function(){l.select(a.end+1,a.end+1)});return false};l.area.onkeydown=function(x){var u=l.selection();if(h<5){h++}else{l.updateHistory();h=0}if(x.shiftKey&&x.keyCode==57){return r("("+u.value+")",u)}if(x.shiftKey&&x.keyCode==219){return r("{"+u.value+"}",u)}if(x.keyCode==219){return r("["+u.value+"]",u)}if(x.shiftKey&&x.keyCode==222){return r('"'+u.value+'"',u)}if(x.keyCode==222){return r("'"+u.value+"'",u)}if(x.shiftKey&&x.keyCode==188){return r("<"+u.value+">",u)}if(x.shiftKey&&x.keyCode==9){l.outdent("( *?[0-9]+. | *?[\\-\\+\\*] |> |"+g.tabSize+")");return false}if(x.keyCode==9){l.indent(g.tabSize);return false}if(x.ctrlKey&&x.keyCode==90){l.undo();return false}if(x.ctrlKey&&x.keyCode==89){l.redo();return false}if(x.keyCode==32){var t=/(^|\n)([0-9]+\.|[\-\+\*])$/;if(u.before.match(t)){l.area.value=u.before.replace(t,"$1 $2 ")+u.value+u.after;l.select(u.end+2,u.end+2);return false}}if(x.keyCode==13){var w=/(^|\n)( *?)([0-9]+\.|[\-\+\*]) (.*?)$/;if(u.before.match(w)){var o=w.exec(u.before),v=/[0-9]+\./.test(o[3])?parseInt(o[3],10)+1+".":o[3];l.insert("\n"+o[2]+v+" ");return false}var i=/(^|\n)( +)(.*?)$/.exec(u.before),a=i?i[2]:"";if(u.before.match(/[\[\{\(\<\>]$/)&&u.after.match(/^[\]\}\)\>\<]/)){l.insert("\n"+a+g.tabSize+"\n"+a,function(){l.select(u.start+a.length+g.tabSize.length+1,u.start+a.length+g.tabSize.length+1)});return false}l.insert("\n"+a);return false}if(x.keyCode==8){if(u.value.length===0&&u.before.match(/( *?)([0-9]+\.|[\-\+\*]) $/)){l.outdent("( *?)([0-9]+.|[-+*]) ");return false}if(u.value.length===0&&u.before.match(new RegExp(g.tabSize+"$"))){l.outdent(g.tabSize);return false}}g.keydown(x,l)};g.ready(l);c.editor=l};
