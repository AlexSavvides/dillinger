/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.1.3
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var MTE=function(e,t){function n(e,t){e=e||{};for(var l in t)e[l]="object"==typeof t[l]?n(e[l],t[l]):t[l];return e}var l=this,i=window,o=document,r=new Editor(e),c={tabSize:"    ",toolbar:!0,shortcut:!1,toolbarClass:"editor-toolbar",toolbarPosition:"before",buttonClassPrefix:"editor-toolbar-button editor-toolbar-button-",iconClassPrefix:"fa fa-",STRONG:"**",EM:"_",UL:"* ",OL:"%d.",HR:"---",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",code:"Code",quote:"Quote",heading:"H1 \u2013 H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompt:{link_title:"link title goes here\u2026",link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholder:{heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){}},a=o.createElement("div"),u=o.createElement("div");l.modal=function(e,t){e=e||"modal";var n=o.body,r=n.scrollTop||o.documentElement.scrollTop;a.className="custom-modal-overlay custom-modal-"+e+"-overlay",a.onclick=function(){l.close(!0)},u.className="custom-modal custom-modal-"+e,u.innerHTML='<div class="custom-modal-header custom-modal-'+e+'-header"></div><div class="custom-modal-content custom-modal-'+e+'-content"></div><div class="custom-modal-action custom-modal-'+e+'-action"></div>',u.style.visibility="hidden",n.appendChild(a),n.appendChild(u),i.setTimeout(function(){var e=u.offsetWidth,t=u.offsetHeight;u.style.position="absolute",u.style.top="50%",u.style.left="50%",u.style.zIndex="9999",u.style.marginTop=r-t/2+"px",u.style.marginLeft="-"+e/2+"px",u.style.visibility="",u.offsetTop<0&&(u.style.top=0,u.style.marginTop=0),u.offsetLeft<0&&(u.style.left=0,u.style.marginLeft=0)},10),"function"==typeof t&&t(a,u)},l.close=function(e){if(a&&o.body.removeChild(a),u&&o.body.removeChild(u),void 0!==e&&e===!0){var t=r.selection();r.select(t.start,t.end)}},l.prompt=function(e,t,n,r){l.modal("prompt",function(c,a){var u=function(e){"function"==typeof r?(l.close(),r(e)):l.close(!0)},f=o.createElement("input");f.type="text",f.value=t,f.onkeyup=function(e){n?13==e.keyCode&&""!==this.value&&this.value!==t&&u(this.value):13==e.keyCode&&u(this.value==t?"":this.value)};var d=o.createElement("button");d.innerHTML=s.buttons.ok,d.onclick=function(){n?""!==f.value&&f.value!==t&&u(f.value):u(f.value==t?"":f.value)};var p=o.createElement("button");p.innerHTML=s.buttons.cancel,p.onclick=function(){l.close(!0)},a.children[0].innerHTML=e?e:"",a.children[1].appendChild(f),a.children[2].appendChild(d),a.children[2].appendChild(o.createTextNode(" ")),a.children[2].appendChild(p),i.setTimeout(function(){f.select()},10)})},l.alert=function(e,t,n){l.modal("alert",function(i,r){var c=o.createElement("button");c.innerHTML=s.buttons.ok,c.onclick=function(){"function"==typeof n?(l.close(),n()):l.close(!0)},r.children[0].innerHTML=e?e:"",r.children[1].innerHTML=t?t:"",r.children[2].appendChild(c)})},l.confirm=function(e,t,n){l.modal("confirm",function(i,r){var c=o.createElement("button");c.innerHTML=s.buttons.ok,c.onclick=function(){void 0===n?l.close(!0):"function"==typeof n.OK?(l.close(),n.OK()):l.close(!0)};var a=o.createElement("button");a.innerHTML=s.buttons.cancel,a.onclick=function(){return void 0===n?l.close(!0):"function"==typeof n.CANCEL?(l.close(),n.CANCEL()):l.close(!0),!1},r.children[0].innerHTML=e?e:"",r.children[1].innerHTML=t?t:"",r.children[2].appendChild(c),r.children[2].appendChild(o.createTextNode(" ")),r.children[2].appendChild(a)})};var s=n(c,t),f=o.createElement("span");s.toolbar&&(f.className=s.toolbarClass,r.area.parentNode.insertBefore(f,"before"==s.toolbarPosition?r.area:null)),l.button=function(e,t){if(t.title!==!1){var n=o.createElement("a");n.className=s.buttonClassPrefix+e,n.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-+|-+$/,""),n.setAttribute("tabindex",-1),n.innerHTML='<i class="'+s.iconClassPrefix+e+'"></i>',n.onclick=function(e){return t.click(e,l),s.click(e,l,this.hash.replace("#","")),!1},t.title&&(n.title=t.title),t.position?f.insertBefore(n,f.children[t.position-1]):f.appendChild(n)}},r.toggle=function(e,t,n){var l=r.selection();if(l.before.slice(-e.length)!=e&&l.after.slice(0,t.length)!=t)r.wrap(e,t);else{var i=l.before.slice(-e.length)==e?l.before.substring(0,l.before.length-e.length):l.before,o=l.after.substring(0,t.length)==t?l.after.substring(t.length):l.after;r.area.value=i+l.value+o,r.select(i.length,i.length+l.value.length,function(){r.updateHistory()})}"function"==typeof n&&n()};var d=0,p=s.buttons,g={bold:{title:p.bold,click:function(){r.toggle(s.STRONG,s.STRONG)}},italic:{title:p.italic,click:function(){r.toggle(s.EM,s.EM)}},code:{title:p.code,click:function(){var e=r.selection().value;-1!==e.indexOf("\n")&&e.length>0?r.indent("    "):r.toggle("`","`")}},"quote-right":{title:p.quote,click:function(){r.indent("> ")}},header:{title:p.heading,click:function(){var e=r.selection(),t=["","# ","## ","### ","#### ","##### ","###### "];if(d=d<t.length-1?d+1:0,e.value.length>0)if(e.before.match(/\#+ $/)){var n=e.before.replace(/\#+ $/,""),l=e.value.replace(/^\#+ /,"");r.area.value=n+t[d]+l+e.after,r.select(n.length+t[d].length,n.length+t[d].length+l.length,function(){r.updateHistory()})}else r.wrap(t[d],"",function(){r.replace(/^\#+ /,"")});else{var i=s.placeholder.heading_text;d=1,r.insert(t[d]+i,function(){e=r.selection().end,r.select(e-i.length-t[d].length+2,e,function(){r.updateHistory()})})}}},link:{title:p.link,click:function(){var e,t,n=r.selection(),i=s.placeholder.link_text;l.prompt(s.prompt.link_title_title,s.prompt.link_title,!1,function(o){e=o,l.prompt(s.prompt.link_url_title,s.prompt.link_url,!0,function(l){t=l,r.wrap("["+(0===n.value.length?i:""),"]("+t+(""!==e?' "'+e+'"':"")+")",function(){r.select(n.start+1,0===n.value.length?n.start+i.length+1:n.end+1,function(){r.updateHistory()})})})})}},image:{title:p.image,click:function(){l.prompt(s.prompt.image_url_title,s.prompt.image_url,!0,function(e){var t=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});t=-1===t.indexOf("/")&&-1!==e.indexOf(".")?t:s.placeholder.image_alt,r.insert("\n!["+t+"]("+e+")\n")})}},"list-ol":{title:p.ol,click:function(){var e=r.selection(),t=0;if(e.value==s.placeholder.list_ol_text)r.select(e.start,e.end);else if(e.value.length>0)r.indent("",function(){r.replace(/^[^\n\r]/gm,function(e){return t++,e.replace(/^/," "+s.OL.replace(/%d/g,t)+" ")})});else{var n=" "+s.OL.replace(/%d/g,1)+" ",l=n+s.placeholder.list_ol_text;r.insert(l,function(){r.select(e.start+n.length,e.start+l.length,function(){r.updateHistory()})})}}},"list-ul":{title:p.ul,click:function(){var e=r.selection();if(e.value==s.placeholder.list_ul_text)r.select(e.start,e.end);else{var t=" "+s.UL+" ";if(e.value.length>0)r.indent(t);else{var n=t+s.placeholder.list_ul_text;r.insert(n,function(){r.select(e.start+t.length,e.start+n.length,function(){r.updateHistory()})})}}}},"ellipsis-h":{title:p.rule,click:function(){r.insert("\n"+s.HR+"\n")}},undo:{title:p.undo,click:function(){r.undo()}},repeat:{title:p.redo,click:function(){r.redo()}}};for(var h in g)l.button(h,g[h]);var m=function(e,t){return r.insert(e,function(){r.select(t.end+1,t.end+1)}),!1};r.area.onkeydown=function(e){var t=r.selection(),n=e.keyCode,o=e.ctrlKey,c=e.shiftKey,a=e.altKey;i.setTimeout(function(){s.keydown(e,l)},10);var u=t.before,f=t.after[0];if(-1!==u.indexOf("(")&&c&&48==n&&")"==f&&"\\"!=u.slice(-1)||-1!==u.indexOf("{")&&c&&221==n&&"}"==f&&"\\"!=u.slice(-1)||-1!==u.indexOf("[")&&221==n&&"]"==f&&"\\"!=u.slice(-1)||-1!==u.indexOf('"')&&c&&222==n&&'"'==f&&"\\"!=u.slice(-1)||-1!==u.indexOf("'")&&!c&&222==n&&"'"==f&&"\\"!=u.slice(-1)||-1!==u.indexOf("`")&&!c&&192==n&&"`"==f&&"\\"!=u.slice(-1)||-1!==u.indexOf("<")&&c&&190==n&&">"==f&&"\\"!=u.slice(-1))return r.select(t.end+1,t.end+1),!1;if(c&&57==n)return m("("+t.value+")",t);if(c&&219==n)return m("{"+t.value+"}",t);if(!c&&219==n)return m("["+t.value+"]",t);if(c&&222==n)return m('"'+t.value+'"',t);if(!c&&222==n)return m("'"+t.value+"'",t);if(!c&&192==n)return m("`"+t.value+"`",t);if(c&&188==n)return m("<"+t.value+">",t);if(c&&9==n)return r.outdent("( *[0-9]+. *| *[-+*] *|> *|"+s.tabSize+")"),!1;if(9==n)return r.indent(s.tabSize),!1;if(o&&90==n)return r.undo(),!1;if(o&&89==n||o&&82==n)return r.redo(),!1;if(s.shortcut){if(o&&66==n)return g.bold.click(),!1;if(o&&73==n)return g.italic.click(),!1;if(o&&81==n)return g["quote-right"].click(),!1;if(a&&81==n)return c?r.toggle("&ldquo;","&rdquo;"):r.toggle("&lsquo;","&rsquo;"),!1;if(o&&72==n)return g.header.click(),!1;if(o&&76==n)return g.link.click(),!1;if(o&&71==n)return g.image.click(),!1}if(32==n){var d=/(^|\n)([0-9]+\.|[-+*])$/;if(t.before.match(d))return r.area.value=t.before.replace(d,"$1 $2 ")+t.value+t.after,r.select(t.end+2,t.end+2,function(){r.updateHistory()}),!1}if(13==n){var p=/(^|\n)( *)([0-9]+\.|[-+*])( *)(.*?)$/;if(t.before.match(p)){var h=p.exec(t.before),v=/[0-9]+\./.test(h[3])?s.OL.replace(/%d/g,parseInt(h[3],10)+1):h[3];return r.insert("\n"+h[2]+v+h[4],null),!1}var b=RegExp("(^|\n)(("+s.tabSize+")+)(.*?)$").exec(t.before),k=b?b[2]:"";if(t.before.match(/[\(\{\[]$/)&&t.after.match(/^[\]\}\)]/)||t.before.match(/<[^\/]*?>$/)&&t.after.match(/^<\//))return r.insert("\n"+k+s.tabSize+"\n"+k,function(){r.select(t.start+k.length+s.tabSize.length+1,t.start+k.length+s.tabSize.length+1,function(){r.updateHistory()})}),!1;if(""!==k)return r.insert("\n"+k),!1}if(8==n&&0===t.value.length){if(t.before.match(/ *([0-9]+\.|[-+*]) *$/))return r.outdent(" *([0-9]+.|[-+*]) *"),!1;if(t.before.match(RegExp(s.tabSize+"$")))return r.outdent(s.tabSize),!1;switch(t.before.slice(-1)){case"(":return r.toggle("(",")"),!1;case"{":return r.toggle("{","}"),!1;case"[":return r.toggle("[","]"),!1;case'"':return r.toggle('"','"'),!1;case"'":return r.toggle("'","'"),!1;case"<":return r.toggle("<",">"),!1;case"*":return r.toggle("*","*"),!1;case"_":return r.toggle("_","_"),!1;case"~":return r.toggle("~","~"),!1;case"`":return r.toggle("`","`"),!1}}r.updateHistory()},s.ready(l),l.grip=r,l.grip.config=s};