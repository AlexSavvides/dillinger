/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.1.0
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 *     REQUIRES:
 *     ======================================================
 *     1. https://github.com/tovic/simple-text-editor-library
 *     2. http://fortawesome.github.io/Font-Awesome/icons
 *     ======================================================
 *
 */

;var MTE=function(e,t){function f(e,t){e=e||{};for(var n in t){if(typeof t[n]==="object"){e[n]=f(e[n],t[n])}else{e[n]=t[n]}}return e}var n=this,r=window,i=document,s=new Editor(e),o={tabSize:"    ",toolbar:true,shortcut:false,toolbarClass:"editor-toolbar",toolbarPosition:"before",iconClassPrefix:"fa fa-",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",bold:"Bold",italic:"Italic",code:"Code",quote:"Quote",heading:"H1 \u2013 H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompt:{link_title:"link title goes here...",link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholder:{heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){}};var u=i.createElement("div"),a=i.createElement("div");n.modal=function(e,t){e=e||"modal";var n=i.body;u.className="custom-modal-overlay custom-"+e+"-overlay";a.className="custom-modal custom-"+e;a.innerHTML='<div class="custom-modal-header custom-'+e+'-header"></div><div class="custom-modal-content custom-'+e+'-content"></div><div class="custom-modal-action custom-'+e+'-action"></div>';n.appendChild(u);n.appendChild(a);if(typeof t=="function")t(u,a)};n.close=function(e){if(u)i.body.removeChild(u);if(a)i.body.removeChild(a);if(typeof e!="undefined"&&e===true){var t=s.selection();s.select(t.start,t.end)}};n.prompt=function(e,t,r,s){n.modal("prompt",function(o,u){var a=function(e){if(typeof s=="function"){n.close();s(e)}else{n.close(true)}};var f=i.createElement("input");f.type="text";f.value=t;f.onkeyup=function(e){if(r){if(e.keyCode==13&&this.value!==""&&this.value!==t)a(this.value)}else{if(e.keyCode==13)a(this.value==t?"":this.value)}};var c=i.createElement("button");c.innerHTML=l.buttons.ok;c.onclick=function(){if(r){if(f.value!==""&&f.value!==t)a(f.value)}else{a(f.value==t?"":f.value)}};var h=i.createElement("button");h.innerHTML=l.buttons.cancel;h.onclick=function(){n.close(true)};u.children[0].innerHTML=e?e:"";u.children[1].appendChild(f);u.children[2].appendChild(c);u.children[2].appendChild(i.createTextNode(" "));u.children[2].appendChild(h);f.select()})};n.alert=function(e,t,r){n.modal("alert",function(s,o){var u=i.createElement("button");u.innerHTML=l.buttons.ok;u.onclick=function(){if(typeof r=="function"){n.close();r()}else{n.close(true)}};o.children[0].innerHTML=e?e:"";o.children[1].innerHTML=t?t:"";o.children[2].appendChild(u)})};n.confirm=function(e,t,r){n.modal("confirm",function(s,o){var u=i.createElement("button");u.innerHTML=l.buttons.ok;u.onclick=function(){if(typeof r=="undefined"){n.close(true)}else{if(typeof r.OK=="function"){n.close();r.OK()}else{n.close(true)}}};var a=i.createElement("button");a.innerHTML=l.buttons.cancel;a.onclick=function(){if(typeof r=="undefined"){n.close(true)}else{if(typeof r.CANCEL=="function"){n.close();r.CANCEL()}else{n.close(true)}}return false};o.children[0].innerHTML=e?e:"";o.children[1].innerHTML=t?t:"";o.children[2].appendChild(u);o.children[2].appendChild(i.createTextNode(" "));o.children[2].appendChild(a)})};var l=f(o,t),c=i.createElement("div");if(l.toolbar){c.className=l.toolbarClass;s.area.parentNode.insertBefore(c,l.toolbarPosition=="before"?s.area:null)}n.button=function(e,t){var r=i.createElement("a");r.href="#"+e;r.innerHTML='<i class="'+l.iconClassPrefix+e+'"></i>';r.onclick=function(r){t.click(r,n);l.click(r,n,e);return false};if(t.title)r.title=t.title;if(t.position){c.insertBefore(r,c.children[t.position-1])}else{c.appendChild(r)}};s.toggle=function(e,t,n){var r=s.selection();if(r.before.slice(-e.length)!=e&&r.after.slice(0,t.length)!=t){s.wrap(e,t)}else{var i=r.before.substring(0,r.before.length-e.length),o=r.after.substring(t.length);s.area.value=i+r.value+o;s.select(i.length,i.length+r.value.length,function(){s.updateHistory()})}if(typeof n=="function")n()};var h=0,p=o.buttons;var d={bold:{title:p.bold,click:function(){s.toggle("**","**")}},italic:{title:p.italic,click:function(){s.toggle("_","_")}},code:{title:p.code,click:function(){var e=s.selection().value;if(e.indexOf("\n")!==-1&&e.length>0){s.indent(l.tabSize)}else{s.toggle("`","`")}}},"quote-right":{title:p.quote,click:function(){s.indent("> ")}},"sort-amount-desc":{title:p.heading,click:function(){var e=s.selection(),t=["","# ","## ","### ","#### ","##### ","###### "];h=h<t.length-1?h+1:0;if(e.value.length>0){if(!e.before.match(/\#+ $/)){s.wrap(t[h],"",function(){s.replace(/^\#+ /,"")})}else{var n=e.before.replace(/\#+ $/,""),r=e.value.replace(/^\#+ /,"");s.area.value=n+t[h]+r+e.after;s.select(n.length+t[h].length,n.length+t[h].length+r.length,function(){s.updateHistory()})}}else{var i=l.placeholder.heading_text;h=1;s.insert(t[h]+i,function(){e=s.selection().end;s.select(e-i.length-t[h].length+2,e,function(){s.updateHistory()})})}}},link:{title:p.link,click:function(){var e=s.selection(),t,r,i=l.placeholder.link_text;n.prompt(l.prompt.link_title_title,l.prompt.link_title,false,function(o){t=o;n.prompt(l.prompt.link_url_title,l.prompt.link_url,true,function(n){r=n;s.wrap("["+(e.value.length===0?i:""),"]("+r+(t!==""?' "'+t+'"':"")+")",function(){s.select(e.start+1,e.value.length===0?e.start+i.length+1:e.end+1,function(){s.updateHistory()})})})})}},image:{title:p.image,click:function(){n.prompt(l.prompt.image_url_title,l.prompt.image_url,true,function(e){var t=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[\-\_\+]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});t=t.indexOf("/")<0?t:l.placeholder.image_alt;s.insert("\n!["+t+"]("+e+")\n")})}},"list-ol":{title:p.ol,click:function(){var e=s.selection(),t=0,n="";if(e.value==l.placeholder.list_ol_text){s.select(e.start,e.end)}else{if(e.value.length>0){s.indent("",function(){s.replace(/^[^\n\r]/gm,function(e){t++;n+=" "+t+". ";return e.replace(/^/," "+t+". ")})})}else{var r=" 1. "+l.placeholder.list_ol_text;s.insert(r,function(){s.select(e.start+4,e.start+r.length)})}}}},"list-ul":{title:p.ul,click:function(){var e=s.selection();if(e.value==l.placeholder.list_ul_text){s.select(e.start,e.end)}else{if(e.value.length>0){s.indent(" * ")}else{var t=" * "+l.placeholder.list_ul_text;s.insert(t,function(){s.select(e.start+3,e.start+t.length)})}}}},"ellipsis-h":{title:p.rule,click:function(){s.insert("\n---\n")}},"rotate-left":{title:p.undo,click:function(){s.undo()}},"rotate-right":{title:p.redo,click:function(){s.redo()}}};for(var v in d)n.button(v,d[v]);var m=function(e,t){s.insert(e,function(){s.select(t.end+1,t.end+1)});return false};s.area.onkeydown=function(e){var t=s.selection(),n=e.keyCode,i=e.ctrlKey,u=e.shiftKey,a=e.altKey;r.setTimeout(function(){l.keydown(e,s)},10);var f=t.before,c=t.after[0];if(f.indexOf("(")!==-1&&u&&n==48&&c==")"||f.indexOf("{")!==-1&&u&&n==221&&c=="}"||f.indexOf("[")!==-1&&n==221&&c=="]"||f.indexOf('"')!==-1&&u&&n==222&&c=='"'||f.indexOf("'")!==-1&&n==222&&c=="'"||f.indexOf("`")!==-1&&!u&&n==192&&c=="`"||f.indexOf("<")!==-1&&u&&n==190&&c==">"){s.select(t.end+1,t.end+1);return false}if(u&&n==57){return m("("+t.value+")",t)}if(u&&n==219){return m("{"+t.value+"}",t)}if(n==219){return m("["+t.value+"]",t)}if(u&&n==222&&t.after[0]!=='"'){return m('"'+t.value+'"',t)}if(n==222&&t.after[0]!=="'"){return m("'"+t.value+"'",t)}if(!u&&n==192){return m("`"+t.value+"`",t)}if(u&&n==188){return m("<"+t.value+">",t)}if(u&&n==9){s.outdent("( *[0-9]+. | *[\\-\\+\\*] |> |"+l.tabSize+")");return false}if(n==9){s.indent(l.tabSize);return false}if(i&&n==90){s.undo();return false}if(i&&n==89||i&&n==82){s.redo();return false}if(o.shortcut){if(i&&n==66){d.bold.click();return false}if(i&&n==73){d.italic.click();return false}if(i&&n==81){d["quote-right"].click();return false}if(a&&n==81){if(u){s.toggle("&ldquo;","&rdquo;")}else{s.toggle("&lsquo;","&rsquo;")}return false}if(i&&n==72){d["sort-amount-desc"].click();return false}if(i&&n==76){d.link.click();return false}if(i&&n==71){d["picture-o"].click();return false}}if(n==32){var h=/(^|\n)([0-9]+\.|[\-\+\*])$/;if(t.before.match(h)){s.area.value=t.before.replace(h,"$1 $2 ")+t.value+t.after;s.select(t.end+2,t.end+2);return false}}if(n==13){var p=/(^|\n)( *?)([0-9]+\.|[\-\+\*]) (.*?)$/;if(t.before.match(p)){var v=p.exec(t.before),g=/[0-9]+\./.test(v[3])?parseInt(v[3],10)+1+".":v[3];s.insert("\n"+v[2]+g+" ",null);return false}var y=(new RegExp("(^|\n)(("+l.tabSize+")+)(.*?)$")).exec(t.before),b=y?y[2]:"";if(t.before.match(/[\(\{\[\>]$/)&&t.after.match(/^[\<\]\}\)]/)){s.insert("\n"+b+l.tabSize+"\n"+b,function(){s.select(t.start+b.length+l.tabSize.length+1,t.start+b.length+l.tabSize.length+1,function(){s.updateHistory()})});return false}s.insert("\n"+b);return false}if(n==8){if(t.value.length===0){if(t.before.match(/( *?)([0-9]+\.|[\-\+\*]) $/)){s.outdent("( *?)([0-9]+.|[-+*]) ");return false}if(t.before.match(new RegExp(l.tabSize+"$"))){s.outdent(l.tabSize);return false}switch(t.before.slice(-1)){case"(":s.toggle("(",")");return false;break;case"{":s.toggle("{","}");return false;break;case"[":s.toggle("[","]");return false;break;case'"':s.toggle('"','"');return false;break;case"'":s.toggle("'","'");return false;break;case"<":s.toggle("<",">");return false;break;case"*":s.toggle("*","*");return false;break;case"_":s.toggle("_","_");return false;break;case"~":s.toggle("~","~");return false;break;case"`":s.toggle("`","`");return false;break}}}s.updateHistory()};l.ready(s);n.grip=s};